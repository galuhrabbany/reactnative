<!DOCTYPE html>
<html>
  <head>
    <title>Leaflet Firebase Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    />

    <style>
      html, body { margin: 0; padding: 0; }
      #map { width: 100vw; height: 100vh; }
      .leaflet-popup-content button {
        margin-top: 5px;
        padding: 4px 8px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .btn-delete { background-color: #f44336; color: #fff; }
    </style>
  </head>

  <body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAYESvyzOj8rPJkOE2qn94Pm4czkb4PJLY",
        authDomain: "reactnative-pgpbl2025.firebaseapp.com",
        databaseURL: "https://reactnative-pgpbl2025-default-rtdb.firebaseio.com",
        projectId: "reactnative-pgpbl2025",
        storageBucket: "reactnative-pgpbl2025.firebasestorage.app",
        messagingSenderId: "770495428833",
        appId: "1:770495428833:web:fe9c779fec09a1b0791fa0",
      };
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();
      const restoRef = database.ref("/resto_locations");

      const map = L.map('map').setView([-7.7956, 110.3695], 13);

      const osm = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      const satellite = L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png", {
        attribution: '&copy; OpenTopoMap contributors'
      });

      const baseMaps = { "OSM": osm, "Satellite": satellite };
      L.control.layers(baseMaps).addTo(map);

      function deletePoint(key) {
        if (confirm("Yakin akan menghapus point ini?")) {
          restoRef.child(key).remove();
          alert("Point deleted!");
        }
      }

      restoRef.on("value", snapshot => {
        const data = snapshot.val();
        if (data) {
          Object.keys(data).forEach(key => {
            const item = data[key];
            if (!item.latitude || !item.longitude) return;
            const coords = [parseFloat(item.latitude), parseFloat(item.longitude)];

            const marker = L.marker(coords).addTo(map);

            const popup = `
              <strong>${item.name}</strong><br>
              [${coords[0].toFixed(5)}, ${coords[1].toFixed(5)}]<br>
              <button class="btn-delete" onclick="deletePoint('${key}')">
                <i class="fa-solid fa-trash"></i> Hapus
              </button>
            `;
            marker.bindPopup(popup);
          });
        }
      }, error => console.log("Read failed: " + error.name));
    </script>
  </body>
</html>
